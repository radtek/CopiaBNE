@model  Sample.Models.Empresa.GridProspect
@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<aside class="right-side">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            Empresas
            <small>prospecção</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="~/Views/Home/"><i class="fa fa-dashboard"></i> Home</a></li>
            <li class="active">Empresa</li>
            <li class="active">prospecção</li>
        </ol>
    </section>
    <!-- Main content -->
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box">
                    <div class="box-header">
                    </div><!-- /.box-header -->
                    <div class="aviso_erro"> @ViewBag.erro</div>
                    @using (Html.BeginForm("Empresas", "EmpresaProspeccao", FormMethod.Post, new { id = "idForm" }))
                    {
                        @Html.HiddenFor(m => m.pag, new { @Value = Model.pag })
                        <input type="submit" id="btnSubmit" style="display:none" />
                        <div class="box-body table-responsive">
                            <table>
                                <tr>
                                    <td>

                                        @Html.DropDownList("rowsPag", new SelectList(new Dictionary<string, int> { { "10", 10 }, { "25", 25 }, {"50", 50 },
                                       { "100", 100 } }, "Key", "Value"), new
                                       {
                                           onchange = "this.form.submit()",
                                           @class = "pro_pag_tf1",
                                           id = "pagesizelist",
                                           rowsPag = Model.rowsPag,
                                           pag = Model.pag,
                                           name = "button"

                                       })

                                        @Html.HiddenFor(m => m.Ordenacao, new { @Value = Model.Ordenacao })
                                        <table>
                                            <tr>
                                                <td>
                                                    @Html.Label("CNJP / Empresa:")<br />
                                                    @Html.TextBox("FlEmpresa", ViewBag.Empresa as string, new { style = "width:170px;border-radius: 4px !important;", @maxlength = "100", @class = "form-control" })
                                                </td>
                                                <td width="10"></td>
                                                <td>
                                                    @Html.Label("Data Cadastro:")<br />
                                                    <div class="input-group">
                                                        @Html.TextBox("FlDataCadastro", ViewBag.reservation as string, new { @class = "form_datetime form-control", @style = "width:169px;" })
                                                    </div><!-- /.input group -->
                                                </td>
                                                <td width="10"></td>
                                                <td>
                                                    @Html.Label("Data Fim Plano:")<br />
                                                    <div class="input-group">
                                                        @Html.TextBox("FlDataUltimoPlano", ViewBag.reservation as string, new { @class = "form_datetime form-control", @style = "width:169px;" })
                                                    </div><!-- /.input group -->
                                                </td>

                                                <td width="10"></td>
                                                <td>
                                                    @Html.Label("Último Plano:")<br />
                                                    @Html.TextBox("FlPlano", ViewBag.FlPlano as string, new { style = "width:170px;border-radius: 4px !important;", @maxlength = "100", @class = "form-control" })
                                                </td>
                                                <td width="10"></td>

                                                <td>

                                                    @Html.Label("Area: ")<br />
                                                    @Html.TextBox("FlArea", ViewBag.Area as string, new { style = "width:170px;border-radius: 4px !important;", @maxlength = "100", @class = "form-control" })
                                                </td>
                                                <td width="10"></td>

                                            </tr>

                                        </table>
                                        <table>
                                            <tr>
                                                <td>
                                                    @Html.Label("Cidade:")<br />
                                                    @Html.TextBox("FlCidade", ViewBag.Cidade as string, new { style = "width:170px;border-radius: 4px !important;", @maxlength = "100", @class = "form-control" })
                                                </td>
                                                <td width="10"></td>
                                                <td>
                                                    @Html.Label("UF:")<br />
                                                    @Html.TextBox("FlEstado", ViewBag.Uf as string, new { style = "width:40px;border-radius: 4px !important;", @maxlength = "2", @class = "form-control" })
                                                </td>

                                                <td width="10"></td>
                                                <td >
                                                    @Html.Label("Situação Filial:")<br />
                                                    @Html.DropDownList("FlSituacaoEmpresa", new SelectList(new Dictionary<int, string> {
                                                   {0, "Selecionar..." },
                                                   {1, "Publicado Empresa"},
                                                   {2, "Publicado Agência"},
                                                   {3, "Aguardando Publicação"},
                                                   {4, "Com Crítica"},
                                                   {5, "Bloqueado"},
                                                   {6, "Cancelado"},
                                                {7, "Pré Cadastro Vaga Rápida"},
                                                {8, "Faltando dados Receita"},
                                                {9, "Cadastrada fora do Horário Comercial"}}, "Key", "Value"), new
                                                {

                                                    @class = "form-control",
                                                    id = "flSituacaoFilial",
                                                    rowsPag = Model.rowsPag,
                                                    pag = Model.pag,
                                                    name = "button"

                                                })
                                                </td>
                                                <td width="10"></td>
                                                <td>
                                                    <br />
                                                    @*@Html.TextBox("SearchString", ViewBag.currentFilter as string)*@
                                                    <button type="submit" id="btnSubmit" value="Filtrar" name="button" class="btn btn-default">
                                                        <span class="glyphicon glyphicon-search"></span> Pesquisar
                                                    </button>
                                                    @*<button type="reset" value="Filtrar" onclick="Limpar();" class="btn btn-default">
                                                            <span class="glyphicon glyphicon-trash"></span> Limpar
                                                        </button>*@

                                                    <input type="hidden" id="currentFilterSituacao" name="currentFilterSituacao" value="@ViewBag.currentFilterSituacao" />
                                                    <input type="hidden" id="sortOrder" name="CurrentSort" value="@ViewBag.CurrentSort" />
                                                    <input type="hidden" id="reservation2" name="reservation" value="@ViewBag.reservation" />
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                            <br />
                            @Html.HiddenFor(m => m.rowsPag, new { @Value = Model.rowsPag })
                            Página @(Model.pag) de @String.Format("{0:0,0}", Model.lista.PageCount) - Total de @String.Format("{0:0,0}", Model.lista.TotalItemCount) Empresas

                            <table id="EmpresaSemPlano" class="table table-bordered table-hover dataTable">
                                <thead>
                                    <tr>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("Data_Ultima_acao desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Data Ultima ação Site" onclick='Ordenar("Data_Ultima_acao desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Data Ultima ação Site" onclick='Ordenar("Data_Ultima_acao asc");' />
                                            }

                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("Data_Ultimo_Atendimento desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Data Ultimo Atendimento" onclick='Ordenar("Data_Ultimo_Atendimento desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Data Ultimo Atendimento" onclick='Ordenar("Data_Ultimo_Atendimento asc");' />
                                            }

                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("Data_Cadastro desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Data Cadastro" onclick='Ordenar("Data_Cadastro desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Data Cadastro" onclick='Ordenar("Data_Cadastro asc");' />
                                            }

                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("num_cnpj desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Num CNPJ" onclick='Ordenar("num_cnpj desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Num CNPJ" onclick='Ordenar("num_cnpj asc");' />
                                            }
                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("empresa desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Empresa" onclick='Ordenar("empresa desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Empresa" onclick='Ordenar("empresa asc");' />
                                            }
                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("area desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Área" onclick='Ordenar("area desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Área" onclick='Ordenar("area asc");' />
                                            }
                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("cidade desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Cidade" onclick='Ordenar("cidade desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Cidade" onclick='Ordenar("cidade asc");' />
                                            }
                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("uf desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="UF" onclick='Ordenar("uf desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="UF" onclick='Ordenar("uf asc");' />
                                            }
                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("Dta_Fim_Plano desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Data Fim Plano" onclick='Ordenar("Dta_Fim_Plano desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Data Fim Plano" onclick='Ordenar("Dta_Fim_Plano asc");' />
                                            }
                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("Ultimo_Plano desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Último Plano" onclick='Ordenar("Ultimo_Plano desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Último Plano" onclick='Ordenar("Ultimo_Plano asc");' />
                                            }
                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("total_acao desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Total Ação" onclick='Ordenar("total_acao desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Total Ação" onclick='Ordenar("total_acao asc");' />
                                            }
                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("Dta_Vencimento desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Vencimento" onclick='Ordenar("Dta_Vencimento desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Vencimento" onclick='Ordenar("Dta_Vencimento asc");' />
                                            }
                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("qtd_funcionario desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Quantidade Funcionários" onclick='Ordenar("qtd_funcionario desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Quantidade Funcionários" onclick='Ordenar("qtd_funcionario asc");' />
                                            }
                                        </th>
                                        <th>
                                            @if (!Model.Ordenacao.Equals("Situacao_Empresa desc"))
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Situação" onclick='Ordenar("Situacao_Empresa desc");' />
                                            }
                                            else
                                            {
                                                <input type="submit" class="botao_grid" name="button" value="Situação" onclick='Ordenar("Situacao_Empresa asc");' />
                                            }
                                        </th>
                                    </tr>
                                </thead>
                                @foreach (var item in Model.lista)
                                {
                                    <tr>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Data_Ultima_Acao_Site)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Dta_Ultimo_Atendimento)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Dta_Cadastro)
                                        </td>
                                        <td>
                                            @item.Num_CNPJ
                                        </td>
                                        <td>
                                            @Html.ActionLink((item.Raz_Social), "Details", new { controller = "Empresa", Id = item.Num_CNPJ })
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Des_Area_BNE)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Nme_Cidade)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Sig_Estado)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Dta_Fim_Plano)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Ultimo_Plano)
                                        </td>

                                        <td>
                                            @Html.DisplayFor(modelItem => item.Total_Acao)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.dta_Vencimento)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.qtd_Funcionarios)
                                        </td>

                                        @switch (item.Idf_Situacao_Filial)
                                        {
                                            case (int)Sample.Enumerador.SituacaoFilial.PublicadoEmpresa:
                                            case (int)Sample.Enumerador.SituacaoFilial.PublicadoAgencia:
                                                <td class="alert alert-success" role="alert">
                                                    @item.Des_Situacao_Filial
                                                </td>
                                                break;
                                            case (int)Sample.Enumerador.SituacaoFilial.ComCritica:
                                            case (int)Sample.Enumerador.SituacaoFilial.FaltandoDadosReceita:
                                                <td class="alert alert-warning" role="alert">
                                                    @item.Des_Situacao_Filial
                                                </td>
                                                break;
                                            case (int)Sample.Enumerador.SituacaoFilial.AguardandoPublicacao:
                                            case (int)Sample.Enumerador.SituacaoFilial.PreCadastroVagaRapida:
                                            case (int)Sample.Enumerador.SituacaoFilial.CadastradaForaHorarioComercial:
                                                <td class="alert alert-info" role="alert">
                                                    @item.Des_Situacao_Filial
                                                </td>
                                                break;
                                            case (int)Sample.Enumerador.SituacaoFilial.Bloqueado:
                                            case (int)Sample.Enumerador.SituacaoFilial.Cancelado:

                                                <td class="alert alert-danger" role="alert">
                                                    @item.Des_Situacao_Filial
                                                </td>
                                                break;
                                            default:
                                                break;
                                        }


                                    </tr>
                                }
                            </table>
                            Página @(Model.pag) de @String.Format("{0:0,0}", Model.lista.PageCount) - Total de @String.Format("{0:0,0}", Model.lista.TotalItemCount) Empresas

                            <div class="container">
                                <nav aria-label="Page navigation" style="margin-left: -4%;">
                                    <ul class="pagination" id="pagination"></ul>
                                </nav>
                            </div>
                        </div>
                    }
                    <div id="div_carregando" class="progresso">
                        <div class="progresso_texto">
                            <img src="~/Content/img/ajax-loader.gif" />
                            <br /> Carregando...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section><!-- /.content -->
</aside><!-- /.right-side -->

@Scripts.Render("~/bundles/datatables")
<script type="text/javascript">

    $(function () {
        var obj = $('#pagination').twbsPagination({
            totalPages: @Model.lista.PageCount,
            visiblePages: 10,
            startPage: @Model.pag,
            onPageClick: function (event, page) {
                Pagina(page);

            }
        });

    });

    function Ordenar(order) {
        document.getElementById('Ordenacao').value = order;
        console.log(document.getElementById('Ordenacao').value);
        document.getElementById('btnSubmit').click();
    }

    $(function () {
        $('#EmpresaSemPlano').dataTable({
            "bPaginate": false,
            "bLengthChange": true,
            "bFilter": false,
            "bServerSide": false,
            "bSort": false,
            "bInfo": false,
            "bAutoWidth": false
        });

    });

    function Pagina(pag) {
        document.getElementById('pag').value = pag;
    }

    $(document).click(function(event) {
        if(event.target.className == 'page-link'){
            document.getElementById('btnSubmit').click();
        }
    });

    $("#idForm").submit(function(e) {
        $("#div_carregando").show();
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        $("li").removeClass("active");
        $("#tables").addClass("active");
        $("#tables_menu").css("display", "block");
        $("#tables_datatables").addClass("active");

        $("#tables_arrow").addClass("fa-angle-down");

        $("#idForm").submit(function(e) {
            $("#div_carregando").show();
        });
        var itens =  document.getElementsByClassName("page-link");
        var pagina = @Model.pag;
        for (var i=0; i< itens.length;i++ ){
            if(itens[i].text == pagina){
                document.getElementsByClassName("page-item")[i].className += " active"
            }
        }

    });
</script>
@section scripts {
    <script type="text/javascript">
        $('#pagesizelist').on('change', function (event) {
            var form =  $(event.target).parents('form');
            form.submit();
        });
    </script>
}

@Scripts.Render("~/Scripts/jquery.unobtrusive-ajax2.js");
@Scripts.Render("~/Scripts/jquery.twbsPagination.min.js");
@Scripts.Render("~/Scripts/AdminLTE/dashboard.js")
@Scripts.Render("~/Scripts/raphael-min.js")
@Scripts.Render("~/Scripts/plugins/morris/morris.min.js")
@Scripts.Render("~/Scripts/plugins/sparkline/jquery.sparkline.min.js")
@Scripts.Render("~/Scripts/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js")
@Scripts.Render("~/Scripts/plugins/jvectormap/jquery-jvectormap-world-mill-en.js")
@Scripts.Render("~/Scripts/plugins/jqueryKnob/jquery.knob.js")
@Scripts.Render("~/Scripts/plugins/daterangepicker/daterangepicker.js")
@Scripts.Render("~/Scripts/plugins/datepicker/bootstrap-datepicker.js")
@Scripts.Render("~/Scripts/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js")
@Scripts.Render("~/Scripts/plugins/iCheck/icheck.min.js")

<script type="text/javascript">
    $(document).ready(function () {
        $("li").removeClass("active");
        $("#dashboard").addClass("active");

    });
    $('#FlDataUltimoPlano').daterangepicker();
    $('#FlDataCadastro').daterangepicker();
</script>


@Scripts.Render("~/bundles/input-mask")
@Scripts.Render("~/bundles/daterangepicker")
@Scripts.Render("~/bundles/colorpicker")
@Scripts.Render("~/bundles/timepicker")
